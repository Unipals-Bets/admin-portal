"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[332],{5332:(se,y,i)=>{i.r(y),i.d(y,{default:()=>oe});var e=i(4496),k=i(9892);let w=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.In1({type:n,selectors:[["app-roles"]],standalone:!0,features:[e.UHJ],decls:1,vars:0,template:function(o,s){1&o&&e.wR5(0,"router-outlet")},dependencies:[k.cP],encapsulation:2,changeDetection:0})}return n})();var a=i(6504),$=i(5657),O=i(3616),g=i(7816),p=i(1368),C=i(3840),I=i(3576),u=i(4060),G=i(1560),b=i(8416),T=i(2156),E=i(9092),Y=i(2096),S=i(7760),h=i(440),L=i(8384),F=i(164),_=i(6700),x=i(9212),m=i(3992),f=i(4704),d=i(7368),D=i(3800),A=i(2700),M=i(6684),P=i(7048);let v=(()=>{class n{constructor(t){this._httpClient=t,this._roles=new _.g(null),this._role=new _.g(null),this._permissions=new _.g(null)}get roles$(){return this._roles.asObservable()}get role$(){return this._role.asObservable()}get permissions$(){return this._permissions.asObservable()}getRoles(){return this._httpClient.get("/api/v1/roles").pipe((0,x.y)(t=>{this._roles.next(t)}))}getPermisssions(){return this._httpClient.get("/api/v1/permissions").pipe((0,x.y)(t=>{this._permissions.next(t)}))}getRoleById(t){return this._roles.pipe((0,m.U)(1),(0,f.k)(o=>{const s=o.find(r=>r.roleId===+t)||null;return this._role.next(s),s}),(0,d.G)(o=>o?(0,A.of)(o):(0,D.c)(()=>new Error("Could not found role with id of "+t+"!"))))}updateRole(t,o){return this.roles$.pipe((0,m.U)(1),(0,d.G)(s=>this._httpClient.patch("/api/v1/roles/update",{id:t,role:o}).pipe((0,f.k)(r=>{console.log("Updated role is",r);const c=s.findIndex(R=>R.roleId===+t);return s[c]=r,this._roles.next(s),r}),(0,d.G)(r=>this.role$.pipe((0,m.U)(1),(0,M.I)(c=>c&&c.roleId===+t),(0,x.y)(()=>(console.log("Updated role in 2 is",r),this._role.next(r),r)))))))}createRole(){return this.roles$.pipe((0,m.U)(1),(0,d.G)(t=>this._httpClient.post("api/v1/roles",{}).pipe((0,f.k)(o=>(this._roles.next([o,...t]),o)))))}deleteRole(t){return this.roles$.pipe((0,m.U)(1),(0,d.G)(o=>this._httpClient.delete("api/v1/roles/delete",{params:{id:t}}).pipe((0,f.k)(s=>{const r=o.findIndex(c=>c.roleId===+t);return o.splice(r,1),this._roles.next(o),s}))))}static#e=this.\u0275fac=function(o){return new(o||n)(e.CoB(P.KK))};static#t=this.\u0275prov=e.wxM({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function N(n,l){1&n&&(e.I0R(0,"div",16),e.wR5(1,"mat-progress-bar",17),e.C$Y()),2&n&&(e.yG2(),e.E7m("mode","indeterminate"))}function U(n,l){1&n&&e.C_f(0)}const B=n=>({$implicit:n});function j(n,l){if(1&n&&(e.SAx(0),e.yuY(1,U,1,0,"ng-container",28),e.k70()),2&n){const t=e.GaO().$implicit;e.GaO(4);const o=e.Gew(18);e.yG2(),e.E7m("ngTemplateOutlet",o)("ngTemplateOutletContext",e.S45(2,B,t))}}function J(n,l){if(1&n){const t=e.KQA();e.SAx(0),e.I0R(1,"div",23)(2,"div",24),e.OEk(3),e.C$Y(),e.I0R(4,"div",25),e.OEk(5),e.C$Y(),e.I0R(6,"div")(7,"button",26),e.qCj("click",function(){const r=e.usT(t).$implicit,c=e.GaO(4);return e.CGJ(c.toggleDetails(r.roleId))}),e.wR5(8,"mat-icon",27),e.C$Y()()(),e.I0R(9,"div",19),e.yuY(10,j,2,4,"ng-container",13),e.C$Y(),e.k70()}if(2&n){const t=l.$implicit,o=e.GaO(4);e.yG2(3),e.oRS(" ",t.roleName," "),e.yG2(2),e.oRS(" ",t.description," "),e.yG2(3),e.E7m("svgIcon",o.isSelectedRole(o.selectedRole,t)?"heroicons_solid:chevron-up":"heroicons_solid:chevron-down"),e.yG2(2),e.E7m("ngIf",o.isSelectedRole(o.selectedRole,t))}}function V(n,l){if(1&n&&(e.SAx(0),e.yuY(1,J,11,4,"ng-container",22),e.k70()),2&n){const t=l.ngIf,o=e.GaO(3);e.yG2(),e.E7m("ngForOf",t)("ngForTrackBy",o.trackByFn)}}function z(n,l){if(1&n&&(e.SAx(0),e.I0R(1,"div",19)(2,"div",20)(3,"div",21),e.OEk(4," Role Name "),e.C$Y(),e.I0R(5,"div",21),e.OEk(6," Role Description "),e.C$Y()(),e.yuY(7,V,2,2,"ng-container",13),e.wVc(8,"async"),e.C$Y(),e.k70()),2&n){const t=e.GaO(2);e.yG2(3),e.E7m("mat-sort-header","rolename"),e.yG2(2),e.E7m("mat-sort-header","roleDescription"),e.yG2(2),e.E7m("ngIf",e.kDX(8,3,t.roles$))}}function K(n,l){if(1&n&&(e.SAx(0),e.yuY(1,z,9,5,"ng-container",18),e.k70()),2&n){const t=l.ngIf;e.GaO();const o=e.Gew(20);e.yG2(),e.E7m("ngIf",t.length>0)("ngIfElse",o)}}function Q(n,l){1&n&&e.wR5(0,"mat-icon",27),2&n&&e.E7m("svgIcon","heroicons_solid:pencil-square")}function W(n,l){1&n&&e.wR5(0,"mat-icon",27),2&n&&e.E7m("svgIcon","heroicons_solid:check")}function X(n,l){if(1&n){const t=e.KQA();e.SAx(0),e.I0R(1,"mat-checkbox",52),e.qCj("change",function(s){const c=e.usT(t).$implicit,R=e.GaO(3);return e.CGJ(R.toggleRolePermissions(c,s))}),e.OEk(2),e.C$Y(),e.k70()}if(2&n){const t=l.$implicit,o=e.GaO(2).$implicit;e.yG2(),e.E7m("color","primary")("checked",null==o.permissions?null:o.permissions.includes(t.permissionName)),e.yG2(),e.oRS(" ",t.permissionName," ")}}function H(n,l){if(1&n&&(e.SAx(0),e.yuY(1,X,3,3,"ng-container",22),e.k70()),2&n){const t=e.GaO(2);e.yG2(),e.E7m("ngForOf",t.filteredPermissions)("ngForTrackBy",t.trackByFn)}}function Z(n,l){1&n&&(e.SAx(0),e.wR5(1,"mat-icon",54),e.I0R(2,"span",55),e.OEk(3,"Role updated"),e.C$Y(),e.k70()),2&n&&(e.yG2(),e.E7m("svgIcon","heroicons_outline:check"))}function q(n,l){1&n&&(e.SAx(0),e.wR5(1,"mat-icon",56),e.I0R(2,"span",55),e.OEk(3,"An error occurred, try again!"),e.C$Y(),e.k70()),2&n&&(e.yG2(),e.E7m("svgIcon","heroicons_outline:x-mark"))}function ee(n,l){if(1&n&&(e.I0R(0,"div",53),e.yuY(1,Z,4,1,"ng-container",13)(2,q,4,1,"ng-container",13),e.C$Y()),2&n){const t=e.GaO(2);e.yG2(),e.E7m("ngIf","success"===t.flashMessage),e.yG2(),e.E7m("ngIf","error"===t.flashMessage)}}function te(n,l){if(1&n){const t=e.KQA();e.I0R(0,"div",29)(1,"div",30)(2,"form",31)(3,"div",32)(4,"div",33)(5,"div",34)(6,"mat-form-field",35)(7,"mat-label"),e.OEk(8,"Role Name"),e.C$Y(),e.wR5(9,"input",36),e.C$Y(),e.I0R(10,"mat-form-field",35)(11,"mat-label"),e.OEk(12,"Description"),e.C$Y(),e.wR5(13,"input",36),e.C$Y()(),e.I0R(14,"div",37)(15,"span",38),e.OEk(16,"Permissions"),e.C$Y(),e.I0R(17,"div",39)(18,"div",40)(19,"div",41),e.wR5(20,"mat-icon",27),e.I0R(21,"input",42),e.qCj("input",function(s){e.usT(t);const r=e.GaO();return e.CGJ(r.filterPermissions(s))}),e.C$Y()(),e.I0R(22,"button",43),e.yuY(23,Q,1,1,"mat-icon",44)(24,W,1,1,"mat-icon",44),e.C$Y()(),e.I0R(25,"div",45),e.yuY(26,H,2,2,"ng-container",13),e.C$Y()()()()(),e.I0R(27,"div",46)(28,"div")(29,"button",47),e.qCj("click",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.closeDetails())}),e.OEk(30," Cancel "),e.C$Y(),e.I0R(31,"button",48),e.qCj("click",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.deleteSelectedRole())}),e.OEk(32," Delete "),e.C$Y()(),e.I0R(33,"div",49),e.yuY(34,ee,3,2,"div",50),e.I0R(35,"button",51),e.qCj("click",function(){e.usT(t);const s=e.GaO();return e.CGJ(s.updateSelectedRole())}),e.OEk(36," Update "),e.C$Y()()()()()()}if(2&n){const t=e.GaO();e.yG2(2),e.E7m("formGroup",t.selectedRoleForm),e.yG2(7),e.E7m("formControlName","roleName"),e.yG2(4),e.E7m("formControlName","description"),e.yG2(7),e.E7m("svgIcon","heroicons_solid:magnifying-glass"),e.yG2(),e.E7m("maxLength",50),e.yG2(2),e.E7m("ngIf",!t.roleEditMode),e.yG2(),e.E7m("ngIf",t.roleEditMode),e.yG2(2),e.E7m("ngIf",!t.roleEditMode),e.yG2(3),e.E7m("color","warn"),e.yG2(5),e.E7m("ngIf",t.flashMessage),e.yG2(),e.E7m("color","primary")}}function ne(n,l){1&n&&(e.I0R(0,"div",57),e.OEk(1," There are no products! "),e.C$Y())}const oe=[{path:"",component:w,children:[{path:"",component:(()=>{class n{constructor(t,o,s,r){this._changeDetectorRef=t,this._fuseConfirmationService=o,this._formBuilder=s,this._roleService=r,this.flashMessage=null,this.isLoading=!1,this.searchInputControl=new a.yM,this.selectedRole=null,this.roleEditMode=!1,this._unsubscribeAll=new $.E}ngOnInit(){this.selectedRoleForm=this._formBuilder.group({roleId:[""],roleName:[],description:[""],permissions:[[]]}),this.roles$=this._roleService.roles$,this._roleService.permissions$.pipe((0,O.a)(this._unsubscribeAll)).subscribe(t=>{this.permissions=t,this.filteredPermissions=t,this._changeDetectorRef.markForCheck()})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}createRole(){this._roleService.createRole().subscribe(t=>{this.selectedRole=t,this.selectedRoleForm.patchValue(t),this._changeDetectorRef.markForCheck()})}deleteSelectedRole(){this._fuseConfirmationService.open({title:"Delete Role",message:"Are you sure you want to remove this role? This action cannot be undone!",actions:{confirm:{label:"Delete"}}}).afterClosed().subscribe(o=>{if("confirmed"===o){const s=this.selectedRoleForm.getRawValue();this._roleService.deleteRole(s.roleId).subscribe(()=>{this.closeDetails()})}})}toggleRolePermissions(t,o){const s=this.selectedRoleForm.get("permissions").value;if(o.checked){if(this.checkIfPermissionExist(s,t))return;const r=[...s,t.permissionName];this.selectedRoleForm.patchValue({permissions:r})}else{const r=s.filter(c=>c!==t.permissionName);this.selectedRoleForm.patchValue({permissions:r})}}filterRoles(t){}isSelectedRole(t,o){return t?.roleId===o?.roleId}checkIfPermissionExist(t,o){return t.some(s=>s===o.permissionName)}toggleDetails(t){this.selectedRole&&this.selectedRole.roleId===+t?this.closeDetails():this._roleService.getRoleById(t).subscribe(o=>{this.selectedRole=o,this.selectedRoleForm.patchValue(o),this._changeDetectorRef.markForCheck()})}closeDetails(){this.selectedRole=null}filterPermissions(t){const o=t.target.value.toLowerCase();this.filteredPermissions=this.permissions.filter(s=>s.permissionName.toLowerCase().includes(o))}updateSelectedRole(){const t=this.selectedRoleForm.getRawValue();this._roleService.updateRole(t.roleId,t).subscribe({next:o=>{this.showFlashMessage("success")},error:o=>{this.showFlashMessage("error")},complete:()=>{this.showFlashMessage("success")}})}showFlashMessage(t){this.flashMessage=t,this._changeDetectorRef.markForCheck(),setTimeout(()=>{this.flashMessage=null,this._changeDetectorRef.markForCheck()},3e3)}static#e=this.\u0275fac=function(o){return new(o||n)(e.GI1(e.kD9),e.GI1(F.q),e.GI1(a.KE),e.GI1(v))};static#t=this.\u0275cmp=e.In1({type:n,selectors:[["app-roles-list"]],standalone:!0,features:[e.UHJ],decls:21,vars:11,consts:[[1,"sm:absolute","sm:inset-0","flex","flex-col","flex-auto","min-w-0","sm:overflow-hidden","bg-card","dark:bg-transparent"],[1,"relative","flex","flex-col","sm:flex-row","flex-0","sm:items-center","sm:justify-between","py-8","px-6","md:px-8","border-b"],["class","absolute inset-x-0 bottom-0",4,"ngIf"],[1,"text-4xl","font-extrabold","tracking-tight"],[1,"flex","shrink-0","items-center","mt-6","sm:mt-0","sm:ml-4"],[1,"fuse-mat-dense","fuse-mat-rounded","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"formControl","autocomplete","placeholder"],["mat-flat-button","",1,"ml-4",3,"color","click"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-col","flex-auto","sm:mb-18","overflow-hidden","sm:overflow-y-auto"],[4,"ngIf"],["rowDetailsTemplate",""],["noRoles",""],[1,"absolute","inset-x-0","bottom-0"],[3,"mode"],[4,"ngIf","ngIfElse"],[1,"grid"],["matSort","","matSortDisableClear","",1,"inventory-grid","z-10","sticky","top-0","grid","gap-4","py-4","px-6","md:px-8","shadow","text-md","font-semibold","text-secondary","bg-gray-50","dark:bg-black","dark:bg-opacity-5"],[1,"hidden","sm:block",3,"mat-sort-header"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"inventory-grid","grid","items-center","gap-4","py-3","px-6","md:px-8","border-b"],[1,"hidden","sm:block"],[1,"truncate","hidden","sm:block"],["mat-stroked-button","",1,"min-w-10","min-h-7","h-7","px-2","leading-6",3,"click"],[1,"icon-size-5",3,"svgIcon"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"shadow-lg","overflow-hidden"],[1,"flex","border-b"],[1,"flex","flex-col","w-full",3,"formGroup"],[1,"flex","flex-col","sm:flex-row","p-8"],[1,"flex","flex-auto","flex-wrap"],[1,"flex","flex-col","w-full","lg:w-2/4","sm:pl-8"],[1,"w-full"],["matInput","",3,"formControlName"],[1,"flex","flex-col","lg:w-2/4","sm:pl-8"],[1,"mb-px","font-medium","leading-tight"],[1,"mt-1.5","rounded-md","border","border-gray-300","dark:border-gray-500","shadow-sm","overflow-hidden"],[1,"flex","items-center","-my-px","py-2","px-3"],[1,"flex","items-center","flex-auto","min-w-0"],["type","text","placeholder","Search permission name",1,"min-w-0","ml-2","py-1","border-0",3,"maxLength","input"],["mat-icon-button","",1,"ml-3","w-8","h-8","min-h-8"],["class","icon-size-5",3,"svgIcon",4,"ngIf"],[1,"h-44","leading-none","overflow-y-auto","border-t","border-gray-300","dark:border-gray-500"],[1,"flex","items-center","justify-between","w-full","border-t","px-8","py-4"],["mat-button","",1,"-ml-4",3,"color","click"],["mat-button","",1,"-ml-4","text-red-300",3,"click"],[1,"flex","items-center"],["class","flex items-center mr-4",4,"ngIf"],["mat-flat-button","",3,"color","click"],[1,"flex","items-center","h-10","min-h-10","pl-1","pr-4",3,"color","checked","change"],[1,"flex","items-center","mr-4"],[1,"text-green-500",3,"svgIcon"],[1,"ml-2"],[1,"text-red-500",3,"svgIcon"],[1,"p-8","sm:p-16","border-t","text-4xl","font-semibold","tracking-tight","text-center"]],template:function(o,s){1&o&&(e.I0R(0,"div",0)(1,"div",1),e.yuY(2,N,2,1,"div",2),e.I0R(3,"div",3),e.OEk(4,"Role Management"),e.C$Y(),e.I0R(5,"div",4)(6,"mat-form-field",5),e.wR5(7,"mat-icon",6)(8,"input",7),e.C$Y(),e.I0R(9,"button",8),e.qCj("click",function(){return s.createRole()}),e.wR5(10,"mat-icon",9),e.I0R(11,"span",10),e.OEk(12,"Add"),e.C$Y()()()(),e.I0R(13,"div",11)(14,"div",12),e.yuY(15,K,2,2,"ng-container",13),e.wVc(16,"async"),e.yuY(17,te,37,11,"ng-template",null,14,e.gJz)(19,ne,2,0,"ng-template",null,15,e.gJz),e.C$Y()()()),2&o&&(e.yG2(2),e.E7m("ngIf",s.isLoading),e.yG2(4),e.E7m("subscriptSizing","dynamic"),e.yG2(),e.E7m("svgIcon","heroicons_solid:magnifying-glass"),e.yG2(),e.E7m("formControl",s.searchInputControl)("autocomplete","off")("placeholder","Search roles"),e.yG2(),e.E7m("color","primary"),e.yG2(),e.E7m("svgIcon","heroicons_outline:plus"),e.yG2(5),e.E7m("ngIf",e.kDX(16,9,s.roles$)))},dependencies:[p.u_,E.Ko,E.wx,u.wb,u.Up,u.w5,u.is,G.oB,G.qL,b.cN,b.yi,a.y,a.sz,a.ot,a.ue,a.u,a.sl,a.ug,a.uW,a.Wo,g.oJ,g.Gw,g.um,h.Su,h.E9,h.e6,p.Iw,p.XV,T.w5,S.GE,Y.d5,I.Ax,C.Vn,C.WK,I.KE,p.a],styles:[".inventory-grid{grid-template-columns:auto 72px}@media (min-width: 600px){.inventory-grid{grid-template-columns:repeat(2,minmax(0,1fr)) 72px}}\n"],encapsulation:2,data:{animation:L.u},changeDetection:0})}return n})(),resolve:{permissions:()=>(0,e.uUt)(v).getPermisssions(),roles:()=>(0,e.uUt)(v).getRoles()}}]}]}}]);